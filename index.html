<!DOCTYPE html>
<html lang="en">
<head>
    <!-- plausible analytics -->
    <script defer data-domain="dlxc5dz6sybbl.cloudfront.net" src="https://plausible.io/js/script.outbound-links.tagged-events.js"></script>
    <script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patrick's Piano Scales & Chords</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIj4KICA8IS0tIEJhY2tncm91bmQgLS0+CiAgPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSIjMWEyMDJjIiByeD0iNiIvPgogIAogIDwhLS0gUGlhbm8gY29udGFpbmVyIC0tPgogIDxyZWN0IHg9IjQiIHk9IjgiIHdpZHRoPSIyNCIgaGVpZ2h0PSIxNiIgZmlsbD0iIzJkMzc0OCIgcng9IjIiLz4KICA8IS0tIFdoaXRlIGtleXMgLS0+CiAgPHJlY3QgeD0iNiIgeT0iMTAiIHdpZHRoPSIzIiBoZWlnaHQ9IjEyIiBmaWxsPSIjZmZmZmZmIiByeD0iMC41Ii8+CiAgPHJlY3QgeD0iMTAiIHk9IjEwIiB3aWR0aD0iMyIgaGVpZ2h0PSIxMiIgZmlsbD0iI2ZmZmZmZiIgcng9IjAuNSIvPgogIDxyZWN0IHg9IjE0IiB5PSIxMCIgd2lkdGg9IjMiIGhlaWdodD0iMTIiIGZpbGw9IiNmZmZmZmYiIHJ4PSIwLjUiLz4KICA8cmVjdCB4PSIxOCIgeT0iMTAiIHdpZHRoPSIzIiBoZWlnaHQ9IjEyIiBmaWxsPSIjZmZmZmZmIiByeD0iMC41Ii8+CiAgPHJlY3QgeD0iMjIiIHk9IjEwIiB3aWR0aD0iMyIgaGVpZ2h0PSIxMiIgZmlsbD0iI2ZmZmZmZiIgcng9IjAuNSIvPgogIAogIDwhLS0gQmxhY2sga2V5cyAtLT4KICA8cmVjdCB4PSI3LjUiIHk9IjEwIiB3aWR0aD0iMiIgaGVpZ2h0PSI4IiBmaWxsPSIjMWEyMDJjIiByeD0iMC4zIi8+CiAgPHJlY3QgeD0iMTEuNSIgeT0iMTAiIHdpZHRoPSIyIiBoZWlnaHQ9IjgiIGZpbGw9IiMxYTIwMmMiIHJ4PSIwLjMiLz4KICA8cmVjdCB4PSIxOS41IiB5PSIxMCIgd2lkdGg9IjIiIGhlaWdodD0iOCIgZmlsbD0iIzFhMjAyYyIgcng9IjAuMyIvPgogIDxyZWN0IHg9IjIzLjUiIHk9IjEwIiB3aWR0aD0iMiIgaGVpZ2h0PSI4IiBmaWxsPSIjMWEyMDJjIiByeD0iMC4zIi8+CiAgCiAgPCEtLSBIaWdobGlnaHRlZCBrZXkgKHVzaW5nIHlvdXIgY29sb3IgcGFsZXR0ZSkgLS0+CiAgPHJlY3QgeD0iMTQiIHk9IjEwIiB3aWR0aD0iMyIgaGVpZ2h0PSIxMiIgZmlsbD0iIzdkOWI4ZSIgcng9IjAuNSIvPgo8L3N2Zz4=">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIj4KICA8IS0tIEJhY2tncm91bmQgLS0+CiAgPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSIjMWEyMDJjIiByeD0iNiIvPgogIAogIDwhLS0gUGlhbm8gY29udGFpbmVyIC0tPgogIDxyZWN0IHg9IjQiIHk9IjgiIHdpZHRoPSIyNCIgaGVpZ2h0PSIxNiIgZmlsbD0iIzJkMzc0OCIgcng9IjIiLz4KICA8IS0tIFdoaXRlIGtleXMgLS0+CiAgPHJlY3QgeD0iNiIgeT0iMTAiIHdpZHRoPSIzIiBoZWlnaHQ9IjEyIiBmaWxsPSIjZmZmZmZmIiByeD0iMC41Ii8+CiAgPHJlY3QgeD0iMTAiIHk9IjEwIiB3aWR0aD0iMyIgaGVpZ2h0PSIxMiIgZmlsbD0iI2ZmZmZmZiIgcng9IjAuNSIvPgogIDxyZWN0IHg9IjE0IiB5PSIxMCIgd2lkdGg9IjMiIGhlaWdodD0iMTIiIGZpbGw9IiNmZmZmZmYiIHJ4PSIwLjUiLz4KICA8cmVjdCB4PSIxOCIgeT0iMTAiIHdpZHRoPSIzIiBoZWlnaHQ9IjEyIiBmaWxsPSIjZmZmZmZmIiByeD0iMC41Ii8+CiAgPHJlY3QgeD0iMjIiIHk9IjEwIiB3aWR0aD0iMyIgaGVpZ2h0PSIxMiIgZmlsbD0iI2ZmZmZmZiIgcng9IjAuNSIvPgogIAogIDwhLS0gQmxhY2sga2V5cyAtLT4KICA8cmVjdCB4PSI3LjUiIHk9IjEwIiB3aWR0aD0iMiIgaGVpZ2h0PSI4IiBmaWxsPSIjMWEyMDJjIiByeD0iMC4zIi8+CiAgPHJlY3QgeD0iMTEuNSIgeT0iMTAiIHdpZHRoPSIyIiBoZWlnaHQ9IjgiIGZpbGw9IiMxYTIwMmMiIHJ4PSIwLjMiLz4KICA8cmVjdCB4PSIxOS41IiB5PSIxMCIgd2lkdGg9IjIiIGhlaWdodD0iOCIgZmlsbD0iIzFhMjAyYyIgcng9IjAuMyIvPgogIDxyZWN0IHg9IjIzLjUiIHk9IjEwIiB3aWR0aD0iMiIgaGVpZ2h0PSI4IiBmaWxsPSIjMWEyMDJjIiByeD0iMC4zIi8+CiAgCiAgPCEtLSBIaWdobGlnaHRlZCBrZXkgKHVzaW5nIHlvdXIgY29sb3IgcGFsZXR0ZSkgLS0+CiAgPHJlY3QgeD0iMTQiIHk9IjEwIiB3aWR0aD0iMyIgaGVpZ2h0PSIxMiIgZmlsbD0iIzdkOWI4ZSIgcng9IjAuNSIvPgo8L3N2Zz4=">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="Learn piano scales and chords with interactive piano">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUGlhbm8gU2NhbGVzICYgQ2hvcmRzIiwic2hvcnRfbmFtZSI6IlBpYW5vTGVhcm4iLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzFhMWEyZSIsInRoZW1lX2NvbG9yIjoiIzFhMWEyZSIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXlOQ0lnYUdWcFoyaDBQU0l5TkNJZ2RtbGxkMEp2ZUQwaU1DQXdJREkwSURJMElpQm1hV3hzUFNJamVEUTJOemhoSWo0OGNtVmpkQ0I0UFNJeklpQjVQU0l6SWlCM2FXUjBhRDBpTVRnaUlHaGxhV2RvZEQwaU1UZ2lJSEo0UFNJeUlpQm1hV3hzUFNJamRIZGxhbkFpTHo0OEwzTjJaejQiLCJzaXplcyI6IjI0eDI0IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    
    <!-- React and Dependencies -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- External CSS - MUST be after Tailwind to override -->
    <link rel="stylesheet" href="styles.css">
    
</head>
<body class="text-white min-h-screen" style="background-color: #1a202c;">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Tracking functions
        const trackSelection = (type, name) => {
            if (window.plausible) {
                window.plausible('Pattern Selected', {
                    props: {
                        type: type,
                        name: name,
                        category: `${type}_selection`
                    }
                });
            }
        };

        const trackShowPattern = (type, name) => {
            if (window.plausible) {
                window.plausible('Show Pattern', {
                    props: {
                        type: type,
                        name: name,
                        action: 'show_pattern'
                    }
                });
            }
        };

        const trackPlay = (type, name) => {
            if (window.plausible) {
                window.plausible('Play Pattern', {
                    props: {
                        type: type,
                        name: name,
                        action: 'play_pattern'
                    }
                });
            }
        };

        const trackKeyPress = (noteName) => {
            if (window.plausible) {
                window.plausible('Key Pressed', {
                    props: {
                        note: noteName,
                        action: 'key_press'
                    }
                });
            }
        };

        const trackModeSwitch = (newMode) => {
            if (window.plausible) {
                window.plausible('Mode Switch', {
                    props: {
                        mode: newMode,
                        action: 'mode_change'
                    }
                });
            }
        };

        // Note definitions - one octave starting from C
        const NOTES = [
            { name: 'C', type: 'white', id: 0 },
            { name: 'C#', type: 'black', id: 1 },
            { name: 'D', type: 'white', id: 2 },
            { name: 'D#', type: 'black', id: 3 },
            { name: 'E', type: 'white', id: 4 },
            { name: 'F', type: 'white', id: 5 },
            { name: 'F#', type: 'black', id: 6 },
            { name: 'G', type: 'white', id: 7 },
            { name: 'G#', type: 'black', id: 8 },
            { name: 'A', type: 'white', id: 9 },
            { name: 'A#', type: 'black', id: 10 },
            { name: 'B', type: 'white', id: 11 }
        ];
        
        // Common scales and chords data (intervals from root note)
        const SCALES = {
        // Major Scales
        'C Major': [0, 2, 4, 5, 7, 9, 11],
        'C# Major': [1, 3, 5, 6, 8, 10, 0],
        'D♭ Major': [1, 3, 5, 6, 8, 10, 0],
        'D Major': [2, 4, 6, 7, 9, 11, 1],
        'D# Major': [3, 5, 7, 8, 10, 0, 2],
        'E♭ Major': [3, 5, 7, 8, 10, 0, 2],
        'E Major': [4, 6, 8, 9, 11, 1, 3],
        'F Major': [5, 7, 9, 10, 0, 2, 4],
        'F# Major': [6, 8, 10, 11, 1, 3, 5],
        'G♭ Major': [6, 8, 10, 11, 1, 3, 5],
        'G Major': [7, 9, 11, 0, 2, 4, 6],
        'G# Major': [8, 10, 0, 1, 3, 5, 7],
        'A♭ Major': [8, 10, 0, 1, 3, 5, 7],
        'A Major': [9, 11, 1, 2, 4, 6, 8],
        'A# Major': [10, 0, 2, 3, 5, 7, 9],
        'B♭ Major': [10, 0, 2, 3, 5, 7, 9],
        'B Major': [11, 1, 3, 4, 6, 8, 10],

        // Natural Minor Scales
        'C Minor': [0, 2, 3, 5, 7, 8, 10],
        'C# Minor': [1, 3, 4, 6, 8, 9, 11],
        'D♭ Minor': [1, 3, 4, 6, 8, 9, 11],
        'D Minor': [2, 4, 5, 7, 9, 10, 0],
        'D# Minor': [3, 5, 6, 8, 10, 11, 1],
        'E♭ Minor': [3, 5, 6, 8, 10, 11, 1],
        'E Minor': [4, 6, 7, 9, 11, 0, 2],
        'F Minor': [5, 7, 8, 10, 0, 1, 3],
        'F# Minor': [6, 8, 9, 11, 1, 2, 4],
        'G♭ Minor': [6, 8, 9, 11, 1, 2, 4],
        'G Minor': [7, 9, 10, 0, 2, 3, 5],
        'G# Minor': [8, 10, 11, 1, 3, 4, 6],
        'A♭ Minor': [8, 10, 11, 1, 3, 4, 6],
        'A Minor': [9, 11, 0, 2, 4, 5, 7],
        'A# Minor': [10, 0, 1, 3, 5, 6, 8],
        'B♭ Minor': [10, 0, 1, 3, 5, 6, 8],
        'B Minor': [11, 1, 2, 4, 6, 7, 9],

        // Harmonic Minor Scales
        'C Harmonic Minor': [0, 2, 3, 5, 7, 8, 11],
        'C# Harmonic Minor': [1, 3, 4, 6, 8, 9, 0],
        'D♭ Harmonic Minor': [1, 3, 4, 6, 8, 9, 0],
        'D Harmonic Minor': [2, 4, 5, 7, 9, 10, 1],
        'D# Harmonic Minor': [3, 5, 6, 8, 10, 11, 2],
        'E♭ Harmonic Minor': [3, 5, 6, 8, 10, 11, 2],
        'E Harmonic Minor': [4, 6, 7, 9, 11, 0, 3],
        'F Harmonic Minor': [5, 7, 8, 10, 0, 1, 4],
        'F# Harmonic Minor': [6, 8, 9, 11, 1, 2, 5],
        'G♭ Harmonic Minor': [6, 8, 9, 11, 1, 2, 5],
        'G Harmonic Minor': [7, 9, 10, 0, 2, 3, 6],
        'G# Harmonic Minor': [8, 10, 11, 1, 3, 4, 7],
        'A♭ Harmonic Minor': [8, 10, 11, 1, 3, 4, 7],
        'A Harmonic Minor': [9, 11, 0, 2, 4, 5, 8],
        'A# Harmonic Minor': [10, 0, 1, 3, 5, 6, 9],
        'B♭ Harmonic Minor': [10, 0, 1, 3, 5, 6, 9],
        'B Harmonic Minor': [11, 1, 2, 4, 6, 7, 10],

        // Major Pentatonic Scales
        'C Major Pentatonic': [0, 2, 4, 7, 9],
        'C# Major Pentatonic': [1, 3, 5, 8, 10],
        'D♭ Major Pentatonic': [1, 3, 5, 8, 10],
        'D Major Pentatonic': [2, 4, 6, 9, 11],
        'D# Major Pentatonic': [3, 5, 7, 10, 0],
        'E♭ Major Pentatonic': [3, 5, 7, 10, 0],
        'E Major Pentatonic': [4, 6, 8, 11, 1],
        'F Major Pentatonic': [5, 7, 9, 0, 2],
        'F# Major Pentatonic': [6, 8, 10, 1, 3],
        'G♭ Major Pentatonic': [6, 8, 10, 1, 3],
        'G Major Pentatonic': [7, 9, 11, 2, 4],
        'G# Major Pentatonic': [8, 10, 0, 3, 5],
        'A♭ Major Pentatonic': [8, 10, 0, 3, 5],
        'A Major Pentatonic': [9, 11, 1, 4, 6],
        'A# Major Pentatonic': [10, 0, 2, 5, 7],
        'B♭ Major Pentatonic': [10, 0, 2, 5, 7],
        'B Major Pentatonic': [11, 1, 3, 6, 8],

        // Minor Pentatonic Scales
        'C Minor Pentatonic': [0, 3, 5, 7, 10],
        'C# Minor Pentatonic': [1, 4, 6, 8, 11],
        'D♭ Minor Pentatonic': [1, 4, 6, 8, 11],
        'D Minor Pentatonic': [2, 5, 7, 9, 0],
        'D# Minor Pentatonic': [3, 6, 8, 10, 1],
        'E♭ Minor Pentatonic': [3, 6, 8, 10, 1],
        'E Minor Pentatonic': [4, 7, 9, 11, 2],
        'F Minor Pentatonic': [5, 8, 10, 0, 3],
        'F# Minor Pentatonic': [6, 9, 11, 1, 4],
        'G♭ Minor Pentatonic': [6, 9, 11, 1, 4],
        'G Minor Pentatonic': [7, 10, 0, 2, 5],
        'G# Minor Pentatonic': [8, 11, 1, 3, 6],
        'A♭ Minor Pentatonic': [8, 11, 1, 3, 6],
        'A Minor Pentatonic': [9, 0, 2, 4, 7],
        'A# Minor Pentatonic': [10, 1, 3, 5, 8],
        'B♭ Minor Pentatonic': [10, 1, 3, 5, 8],
        'B Minor Pentatonic': [11, 2, 4, 6, 9],

        // Blues Scales
        'C Blues': [0, 3, 5, 6, 7, 10],
        'C# Blues': [1, 4, 6, 7, 8, 11],
        'D♭ Blues': [1, 4, 6, 7, 8, 11],
        'D Blues': [2, 5, 7, 8, 9, 0],
        'D# Blues': [3, 6, 8, 9, 10, 1],
        'E♭ Blues': [3, 6, 8, 9, 10, 1],
        'E Blues': [4, 7, 9, 10, 11, 2],
        'F Blues': [5, 8, 10, 11, 0, 3],
        'F# Blues': [6, 9, 11, 0, 1, 4],
        'G♭ Blues': [6, 9, 11, 0, 1, 4],
        'G Blues': [7, 10, 0, 1, 2, 5],
        'G# Blues': [8, 11, 1, 2, 3, 6],
        'A♭ Blues': [8, 11, 1, 2, 3, 6],
        'A Blues': [9, 0, 2, 3, 4, 7],
        'A# Blues': [10, 1, 3, 4, 5, 8],
        'B♭ Blues': [10, 1, 3, 4, 5, 8],
        'B Blues': [11, 2, 4, 5, 6, 9]
        };
        
        //const CHORDS = {
        //    'C Major': [0, 4, 7],
        //    'C Minor': [0, 3, 7],
        //    'C7': [0, 4, 7, 10],
        //    'Cmaj7': [0, 4, 7, 11],
        //    'Dm': [2, 5, 9],
        //    'Em': [4, 7, 11],
        //    'F Major': [5, 9, 0],
        //    'G Major': [7, 11, 2],
        //    'Am': [9, 0, 4],
        //    'Bdim': [11, 2, 5],
        //};

        const CHORDS = {
        // Major Chords
        'C Major': [0, 4, 7],
        'C# Major': [1, 5, 8],
        'D♭ Major': [1, 5, 8],
        'D Major': [2, 6, 9],
        'D# Major': [3, 7, 10],
        'E♭ Major': [3, 7, 10],
        'E Major': [4, 8, 11],
        'F Major': [5, 9, 0],
        'F# Major': [6, 10, 1],
        'G♭ Major': [6, 10, 1],
        'G Major': [7, 11, 2],
        'G# Major': [8, 0, 3],
        'A♭ Major': [8, 0, 3],
        'A Major': [9, 1, 4],
        'A# Major': [10, 2, 5],
        'B♭ Major': [10, 2, 5],
        'B Major': [11, 3, 6],

        // Minor Chords
        'C Minor': [0, 3, 7],
        'C# Minor': [1, 4, 8],
        'D♭ Minor': [1, 4, 8],
        'D Minor': [2, 5, 9],
        'D# Minor': [3, 6, 10],
        'E♭ Minor': [3, 6, 10],
        'E Minor': [4, 7, 11],
        'F Minor': [5, 8, 0],
        'F# Minor': [6, 9, 1],
        'G♭ Minor': [6, 9, 1],
        'G Minor': [7, 10, 2],
        'G# Minor': [8, 11, 3],
        'A♭ Minor': [8, 11, 3],
        'A Minor': [9, 0, 4],
        'A# Minor': [10, 1, 5],
        'B♭ Minor': [10, 1, 5],
        'B Minor': [11, 2, 6]
        };

        // Piano Key Component
        function PianoKey({ note, isActive, isHighlighted, onClick, showLabel }) {
            const handleClick = () => {
                onClick(note.id);
            };

            return (
                <div
                    className={`piano-key ${note.type}-key ${isActive ? 'active' : ''} ${isHighlighted ? 'highlighted' : ''}`}
                    onClick={handleClick}
                    onMouseDown={(e) => e.preventDefault()}
                >
                    {showLabel && note.name}
                </div>
            );
        }

        // Main Piano Component
        function Piano({ activeNotes, highlightedNotes, onKeyPress, showLabels }) {
            return (
                <div className="piano-container">
                    {NOTES.map(note => (
                        <PianoKey
                            key={note.id}
                            note={note}
                            isActive={activeNotes.includes(note.id)}
                            isHighlighted={highlightedNotes.includes(note.id)}
                            onClick={onKeyPress}
                            showLabel={showLabels}
                        />
                    ))}
                </div>
            );
        }

        function PianoApp() {
            const [activeNotes, setActiveNotes] = useState([]);
            const [highlightedNotes, setHighlightedNotes] = useState([]);
            const [currentMode, setCurrentMode] = useState('scales');
            const [selectedItem, setSelectedItem] = useState('C Major');
            const [showNoteNames, setShowNoteNames] = useState(true);
            const [isPlaying, setIsPlaying] = useState(false);

            useEffect(() => {
                let modeStartTime = Date.now();
                let isVisible = !document.hidden;
                
                const handleVisibilityChange = () => {
                    const now = Date.now();
                    
                    if (document.hidden && isVisible) {
                        // User left the page - track time spent
                        const timeSpent = now - modeStartTime;
                        if (timeSpent > 2000) { // Only count sessions >2 seconds
                            window.plausible('Mode Session', {
                                props: {
                                    mode: currentMode,
                                    duration_seconds: Math.floor(timeSpent / 1000),
                                    action: 'session_duration'
                                }
                            });
                        }
                        isVisible = false;
                    } else if (!document.hidden && !isVisible) {
                        // User returned - restart timer
                        modeStartTime = now;
                        isVisible = true;
                    }
                };
                
                document.addEventListener('visibilitychange', handleVisibilityChange);
                
                return () => {
                    document.removeEventListener('visibilitychange', handleVisibilityChange);
                    // Track final session on unmount
                    if (isVisible) {
                        const timeSpent = Date.now() - modeStartTime;
                        if (timeSpent > 2000) {
                            window.plausible('Mode Session', {
                                props: {
                                    mode: currentMode,
                                    duration_seconds: Math.floor(timeSpent / 1000),
                                    action: 'session_duration'
                                }
                            });
                        }
                    }
                };
            }, [currentMode]); // This dependency means it re-runs when currentMode changes


            // Get current pattern notes
            const getCurrentNotes = () => {
                const intervals = currentMode === 'scales' ? SCALES[selectedItem] : CHORDS[selectedItem];
                return intervals || [];
            };

            // Handle key press
            const handleKeyPress = (noteId) => {
                setActiveNotes([noteId]);
                setTimeout(() => setActiveNotes([]), 150);
                trackKeyPress(NOTES[noteId].name);
            };

            // Play the current scale/chord
            const playSequence = () => {
                if (isPlaying) return;
                trackPlay(currentMode === 'scales' ? 'scale' : 'chord', selectedItem);
                
                setIsPlaying(true);
                const notes = getCurrentNotes();
                setHighlightedNotes([]);
                
                if (currentMode === 'scales') {
                    // Play scale notes in sequence
                    notes.forEach((note, index) => {
                        setTimeout(() => {
                            setActiveNotes([note]);
                            if (index === notes.length - 1) {
                                setTimeout(() => {
                                    setActiveNotes([]);
                                    setIsPlaying(false);
                                }, 400);
                            }
                        }, index * 400);
                    });
                } else {
                    // Play chord notes together
                    setActiveNotes(notes);
                    setTimeout(() => {
                        setActiveNotes([]);
                        setIsPlaying(false);
                    }, 1500);
                }
            };

            // Show the scale/chord pattern
            const showPattern = () => {
                const notes = getCurrentNotes();
                setHighlightedNotes(notes);
                setActiveNotes([]);
                trackShowPattern(currentMode === 'scales' ? 'scale' : 'chord', selectedItem);
            };

            // Clear the pattern
            const clearPattern = () => {
                setHighlightedNotes([]);
                setActiveNotes([]);
            };

            // Get note names for display
            const getNoteNames = () => {
                const notes = getCurrentNotes();
                return notes.map(noteId => NOTES[noteId].name);
            };

            return (
                <div className="min-h-screen p-4" style={{backgroundColor: '#1a202c'}}>
                    <div className="max-w-4xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <h1 className="text-4xl font-bold mb-2 text-primary">
                                🎹 Patrick's Piano Scales & Chords
                            </h1>
                            <p className="text-secondary">Learn and practice piano patterns</p>
                        </div>

                        {/* Mode Toggle */}
                        <div className="flex justify-center mb-6">
                            <div 
                                className="rounded-lg p-1 flex"
                                style={{
                                    backgroundColor: '#1f2937',
                                    border: '1px solid #2d5c4b'
                                }}
                            >
                                <button
                                    onClick={() => {
                                        setCurrentMode('scales');
                                        setSelectedItem('C Major');
                                        clearPattern();
                                        trackModeSwitch('scales'); // ADD THIS
                                    }}
                                    className="px-6 py-2 rounded-md"
                                    style={{
                                        backgroundColor: currentMode === 'scales' ? '#e4d59b' : 'transparent',
                                        color: currentMode === 'scales' ? '#1a202c' : '#f9fafb',
                                        fontWeight: currentMode === 'scales' ? '600' : '500',
                                        transition: 'all 0.2s ease'
                                    }}
                                >
                                    Scales
                                </button>
                                <button
                                    onClick={() => {
                                        setCurrentMode('chords');
                                        setSelectedItem('C Major');
                                        clearPattern();
                                    }}
                                    className="px-6 py-2 rounded-md"
                                    style={{
                                        backgroundColor: currentMode === 'chords' ? '#e4d59b' : 'transparent',
                                        color: currentMode === 'chords' ? '#1a202c' : '#f9fafb',
                                        fontWeight: currentMode === 'chords' ? '600' : '500',
                                        transition: 'all 0.2s ease'
                                    }}
                                >
                                    Chords
                                </button>
                            </div>
                        </div>

                        {/* Selection Dropdown */}
                        <div className="flex justify-center mb-6">
                            <select
                                value={selectedItem}
                                onChange={(e) => {
                                    setSelectedItem(e.target.value);
                                    clearPattern();
                                    trackSelection(currentMode === 'scales' ? 'scale' : 'chord', e.target.value); // ADD THIS
                        
                                }}
                                className="px-4 py-2 rounded-lg border focus:outline-none"
                                style={{
                                    backgroundColor: 'rgb(4, 98, 75)',
                                    color: '#ffffff',
                                    borderColor: '#7d9b8e',
                                    fontWeight: '500'
                                }}
                            >
                                {Object.keys(currentMode === 'scales' ? SCALES : CHORDS).map(item => (
                                    <option key={item} value={item} style={{backgroundColor: 'rgb(4, 98, 75)', color: '#ffffff'}}>{item}</option>
                                ))}
                            </select>
                        </div>

                        {/* Control Buttons */}
                        <div className="flex flex-wrap justify-center gap-4 mb-6">
                            <button
                                onClick={showPattern}
                                className="px-6 py-2 rounded-lg font-semibold"
                                style={{
                                    backgroundColor: '#7d9b8e',
                                    color: '#ffffff',
                                    border: '2px solid #bac4a1',
                                    fontWeight: '600',
                                    textShadow: '0 1px 2px rgba(0, 0, 0, 0.3)',
                                    transition: 'all 0.2s ease'
                                }}
                                onMouseEnter={(e) => {
                                    e.target.style.backgroundColor = '#bac4a1';
                                    e.target.style.color = '#1a202c';
                                    e.target.style.textShadow = 'none';
                                    e.target.style.transform = 'translateY(-1px)';
                                }}
                                onMouseLeave={(e) => {
                                    e.target.style.backgroundColor = '#7d9b8e';
                                    e.target.style.color = '#ffffff';
                                    e.target.style.textShadow = '0 1px 2px rgba(0, 0, 0, 0.3)';
                                    e.target.style.transform = 'translateY(0)';
                                }}
                            >
                                Show Pattern
                            </button>
                            <button
                                onClick={playSequence}
                                disabled={isPlaying}
                                className="px-6 py-2 rounded-lg font-semibold"
                                style={{
                                    backgroundColor: isPlaying ? '#4b5563' : '#4a786d',
                                    color: isPlaying ? '#9ca3af' : '#ffffff',
                                    border: isPlaying ? '2px solid #374151' : '2px solid #7d9b8e',
                                    fontWeight: '600',
                                    textShadow: isPlaying ? 'none' : '0 1px 2px rgba(0, 0, 0, 0.3)',
                                    transition: 'all 0.2s ease',
                                    cursor: isPlaying ? 'not-allowed' : 'pointer',
                                    opacity: isPlaying ? 0.7 : 1
                                }}
                                onMouseEnter={(e) => {
                                    if (!isPlaying) {
                                        e.target.style.backgroundColor = '#2d5c4b';
                                        e.target.style.transform = 'translateY(-1px)';
                                    }
                                }}
                                onMouseLeave={(e) => {
                                    if (!isPlaying) {
                                        e.target.style.backgroundColor = '#4a786d';
                                        e.target.style.transform = 'translateY(0)';
                                    }
                                }}
                            >
                                {isPlaying ? 'Playing...' : 'Play'}
                            </button>
                            <button
                                onClick={clearPattern}
                                className="px-6 py-2 rounded-lg font-semibold"
                                style={{
                                    backgroundColor: '#bac4a1',
                                    color: '#1a202c',
                                    border: '2px solid #7d9b8e',
                                    fontWeight: '600',
                                    transition: 'all 0.2s ease'
                                }}
                                onMouseEnter={(e) => {
                                    e.target.style.backgroundColor = '#7d9b8e';
                                    e.target.style.color = '#ffffff';
                                    e.target.style.transform = 'translateY(-1px)';
                                }}
                                onMouseLeave={(e) => {
                                    e.target.style.backgroundColor = '#bac4a1';
                                    e.target.style.color = '#1a202c';
                                    e.target.style.transform = 'translateY(0)';
                                }}
                            >
                                Clear
                            </button>
                        </div>

                        {/* Settings */}
                        <div className="flex justify-center mb-6">
                            <label className="flex items-center space-x-2 cursor-pointer">
                                <input
                                    type="checkbox"
                                    checked={showNoteNames}
                                    onChange={(e) => setShowNoteNames(e.target.checked)}
                                    className="w-4 h-4 rounded focus:ring-2"
                                    style={{
                                        accentColor: '#7d9b8e'
                                    }}
                                />
                                <span className="text-secondary">Show note names</span>
                            </label>
                        </div>

                        {/* Piano */}
                        <Piano
                            activeNotes={activeNotes}
                            highlightedNotes={highlightedNotes}
                            onKeyPress={handleKeyPress}
                            showLabels={showNoteNames}
                        />

                        {/* Pattern Info */}
                        <div className="card-bg rounded-lg p-6 text-center mt-6">
                            <h3 className="text-xl font-bold mb-2 text-primary">
                                {selectedItem} {currentMode === 'scales' ? 'Scale' : 'Chord'}
                            </h3>
                            <p className="text-secondary mb-4 font-medium">
                                Notes: {getNoteNames().join(' - ')}
                            </p>
                            <p className="text-sm text-muted">
                                {currentMode === 'scales' 
                                    ? 'Click "Show Pattern" to see the scale notes, or "Play" to see them in sequence'
                                    : 'Click "Show Pattern" to see the chord notes, or "Play" to see them together'
                                }
                            </p>
                        </div>

                        {/* Instructions */}
                        <div className="card-bg mt-8 rounded-lg p-6">
                            <h3 className="text-lg font-bold mb-3 text-primary">How to Use:</h3>
                            <ul className="text-secondary space-y-2 text-sm font-medium">
                                <li>• Switch between Scales and Chords using the toggle buttons</li>
                                <li>• Select different scales/chords from the dropdown menu</li>
                                <li>• Click "Show Pattern" to highlight the notes on the piano</li>
                                <li>• Click "Play" to see the pattern animated</li>
                                <li>• Click individual piano keys to play them</li>
                                <li>• Toggle note names on/off to test your knowledge</li>
                                <li> Made with ❤️ by <a href="https://patrickmccanna.net">Patrick McCanna </a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'piano-pwa-v1';
                const urlsToCache = ['/'];
                
                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => cache.addAll(urlsToCache))
                    );
                });
                
                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => response || fetch(event.request))
                    );
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(registration => console.log('SW registered'))
                .catch(error => console.log('SW registration failed'));
        }

        // Render the app
        ReactDOM.render(<PianoApp />, document.getElementById('root'));
    </script>
</body>
</html>
